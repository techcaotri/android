
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Live555 - Live555 source code analysis_describe processing Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="@gitbook-ng/gitbook 3.3.6">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchor-navigation-ex-toc/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-expandable-chapters-interactive/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Live555 - Live555 source code analysis_setup processing.html" />
    
    
    <link rel="prev" href="Live555 - Live555 source code analysis_rtspserver.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Graphical Android
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="Graphical Android - Zygote, System Server startup analysis.html">
            
                <a href="Graphical Android - Zygote, System Server startup analysis.html">
            
                    
                    Graphical Android - Zygote, System Server startup analysis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Android Permissions
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="Android Permissions - Android Runtime Permission.html">
            
                <a href="Android Permissions - Android Runtime Permission.html">
            
                    
                    Android Permissions - Android Runtime Permission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Android Permissions - Android grantRuntimePermission Detailed.html">
            
                <a href="Android Permissions - Android grantRuntimePermission Detailed.html">
            
                    
                    Android Permissions - Android grantRuntimePermission Detailed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="Android Permissions - Android GrantPermissionsActivity Detailed.html">
            
                <a href="Android Permissions - Android GrantPermissionsActivity Detailed.html">
            
                    
                    Android Permissions - Android GrantPermissionsActivity Detailed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="Android Permissions - AppOps control for Normal permission.html">
            
                <a href="Android Permissions - AppOps control for Normal permission.html">
            
                    
                    Android Permissions - AppOps control for Normal permission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="Android Permissions - Android native permission control process.html">
            
                <a href="Android Permissions - Android native permission control process.html">
            
                    
                    Android Permissions - Android native permission control process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="Android Permissions - The difference between setUidMode and setMode in AppOps.html">
            
                <a href="Android Permissions - The difference between setUidMode and setMode in AppOps.html">
            
                    
                    Android Permissions - The difference between setUidMode and setMode in AppOps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="Android Permissions - Application permissions before android M and application permissions after M.html">
            
                <a href="Android Permissions - Application permissions before android M and application permissions after M.html">
            
                    
                    Android Permissions - Application permissions before android M and application permissions after M
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="Android Permissions - Provider permissions detailed.html">
            
                <a href="Android Permissions - Provider permissions detailed.html">
            
                    
                    Android Permissions - Provider permissions detailed
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Android OTA
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="Android OTA - Android OTA upgrade principle and process analysis 1.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 1.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="Android OTA - Android OTA upgrade principle and process analysis 2.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 2.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="Android OTA - Android OTA upgrade principle and process analysis 3.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 3.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="Android OTA - Android OTA upgrade principle and process analysis 4.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 4.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="Android OTA - Android OTA upgrade principle and process analysis 5.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 5.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="Android OTA - Android OTA upgrade principle and process analysis 6.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 6.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="Android OTA - Android OTA upgrade principle and process analysis 7.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 7.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="Android OTA - Android OTA upgrade principle and process analysis 8.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 8.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="Android OTA - Android OTA upgrade principle and process analysis 9.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 9.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 9
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Android Package Manager Service (PMS)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Android PMS - Explore the Android PMS service.html">
            
                <a href="Android PMS - Explore the Android PMS service.html">
            
                    
                    Android PMS - Explore the Android PMS service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="Android PMS - Some rules of the PMS runtime.html">
            
                <a href="Android PMS - Some rules of the PMS runtime.html">
            
                    
                    Android PMS - Some rules of the PMS runtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="Android PMS - Android 6 PMS Analysis.html">
            
                <a href="Android PMS - Android 6 PMS Analysis.html">
            
                    
                    Android PMS - Android 6 PMS Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="Android PMS - Android 6 PMS analysis article 1.html">
            
                <a href="Android PMS - Android 6 PMS analysis article 1.html">
            
                    
                    Android PMS - Android 6 PMS analysis article 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="Android PMS - Android 6 PMS analysis article 2.html">
            
                <a href="Android PMS - Android 6 PMS analysis article 2.html">
            
                    
                    Android PMS - Android 6 PMS analysis article 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="Android PMS - Android 6 PMS analysis of the next article.html">
            
                <a href="Android PMS - Android 6 PMS analysis of the next article.html">
            
                    
                    Android PMS - Android 6 PMS analysis of the next article
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="Android PMS - Android 6 PMS install APK prelude.html">
            
                <a href="Android PMS - Android 6 PMS install APK prelude.html">
            
                    
                    Android PMS - Android 6 PMS install APK prelude
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="Android PMS - Android 6 PMS installation APK.html">
            
                <a href="Android PMS - Android 6 PMS installation APK.html">
            
                    
                    Android PMS - Android 6 PMS installation APK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="Android PMS - Android 6 PMS installation APK next article.html">
            
                <a href="Android PMS - Android 6 PMS installation APK next article.html">
            
                    
                    Android PMS - Android 6 PMS installation APK next article
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="Android PMS - Android 6 PMS Uninstall APK.html">
            
                <a href="Android PMS - Android 6 PMS Uninstall APK.html">
            
                    
                    Android PMS - Android 6 PMS Uninstall APK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="Android PMS - Android 6 PMS daemon installd.html">
            
                <a href="Android PMS - Android 6 PMS daemon installd.html">
            
                    
                    Android PMS - Android 6 PMS daemon installd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Android AOSP
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="Android AOSP - Debugging AOSP Platform code with Android Studio - Java Debugger.html">
            
                <a href="Android AOSP - Debugging AOSP Platform code with Android Studio - Java Debugger.html">
            
                    
                    Android AOSP - Debugging AOSP Platform code with Android Studio - Java Debugger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="Android AOSP - Modify applications and rebuild emulator image effectively.html">
            
                <a href="Android AOSP - Modify applications and rebuild emulator image effectively.html">
            
                    
                    Android AOSP - Modify applications and rebuild emulator image effectively
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Android General
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="Android General - Reliable connection to AIDL IPC Service in Android.html">
            
                <a href="Android General - Reliable connection to AIDL IPC Service in Android.html">
            
                    
                    Android General - Reliable connection to AIDL IPC Service in Android
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Android Binder
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Android Activity Manager Service (AMS)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    Live555
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="Live555 - Live555 source code analysis_introduction.html">
            
                <a href="Live555 - Live555 source code analysis_introduction.html">
            
                    
                    Live555 - Live555 source code analysis_introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="Live555 - Live555 source code analysis_infrastructure.html">
            
                <a href="Live555 - Live555 source code analysis_infrastructure.html">
            
                    
                    Live555 - Live555 source code analysis_infrastructure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="Live555 - Live555 source code analysis_mediaserver.html">
            
                <a href="Live555 - Live555 source code analysis_mediaserver.html">
            
                    
                    Live555 - Live555 source code analysis_mediaserver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="Live555 - Wireshark capture packet analysis RTSP_RTP_RTCP basic working process.html">
            
                <a href="Live555 - Wireshark capture packet analysis RTSP_RTP_RTCP basic working process.html">
            
                    
                    Live555 - Wireshark capture packet analysis RTSP_RTP_RTCP basic working process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="Live555 - Live555 source code analysis_rtspserver.html">
            
                <a href="Live555 - Live555 source code analysis_rtspserver.html">
            
                    
                    Live555 - Live555 source code analysis_rtspserver
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10.6" data-path="Live555 - Live555 source code analysis_describe processing.html">
            
                <a href="Live555 - Live555 source code analysis_describe processing.html">
            
                    
                    Live555 - Live555 source code analysis_describe processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="Live555 - Live555 source code analysis_setup processing.html">
            
                <a href="Live555 - Live555 source code analysis_setup processing.html">
            
                    
                    Live555 - Live555 source code analysis_setup processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="Live555 - Live555 source code analysis_play processing.html">
            
                <a href="Live555 - Live555 source code analysis_play processing.html">
            
                    
                    Live555 - Live555 source code analysis_play processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="Live555 - Live555 source code analysis_RTSPServer component structure.html">
            
                <a href="Live555 - Live555 source code analysis_RTSPServer component structure.html">
            
                    
                    Live555 - Live555 source code analysis_RTSPServer component structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="Live555 - Live555 source code analysis_servermediasession.html">
            
                <a href="Live555 - Live555 source code analysis_servermediasession.html">
            
                    
                    Live555 - Live555 source code analysis_servermediasession
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="Live555 - Live555 source code analysis_subsession SDP line generation.html">
            
                <a href="Live555 - Live555 source code analysis_subsession SDP line generation.html">
            
                    
                    Live555 - Live555 source code analysis_subsession SDP line generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="Live555 - Live555 source code analysis_Subsession SETUP.html">
            
                <a href="Live555 - Live555 source code analysis_Subsession SETUP.html">
            
                    
                    Live555 - Live555 source code analysis_Subsession SETUP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="Live555 - Live555 source code analysis_play start.html">
            
                <a href="Live555 - Live555 source code analysis_play start.html">
            
                    
                    Live555 - Live555 source code analysis_play start
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    Flutter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="Flutter Framework Analysis 1 - Overview and Window.html">
            
                <a href="Flutter Framework Analysis 1 - Overview and Window.html">
            
                    
                    Flutter Framework Analysis 1 - Overview and Window
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="Flutter Framework Analysis 2 - Initialization.html">
            
                <a href="Flutter Framework Analysis 2 - Initialization.html">
            
                    
                    Flutter Framework Analysis 2 - Initialization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="Flutter Framework Analysis 3 - Widget, Element and RenderObject.html">
            
                <a href="Flutter Framework Analysis 3 - Widget, Element and RenderObject.html">
            
                    
                    Flutter Framework Analysis 3 - Widget, Element and RenderObject
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="Flutter Framework Analysis 4 - Flutter Framework Operation.html">
            
                <a href="Flutter Framework Analysis 4 - Flutter Framework Operation.html">
            
                    
                    Flutter Framework Analysis 4 - Flutter Framework Operation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="Flutter Framework Analysis 5 - Animation.html">
            
                <a href="Flutter Framework Analysis 5 - Animation.html">
            
                    
                    Flutter Framework Analysis 5 - Animation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="Flutter Framework Analysis 6 - Layout.html">
            
                <a href="Flutter Framework Analysis 6 - Layout.html">
            
                    
                    Flutter Framework Analysis 6 - Layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="Flutter Framework Analysis 7 - Drawing.html">
            
                <a href="Flutter Framework Analysis 7 - Drawing.html">
            
                    
                    Flutter Framework Analysis 7 - Drawing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Live555 - Live555 source code analysis_describe processing</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><span class="title-icon "></span><a href="#live555-source-code-analysis-describe-processing"><b>1. </b>Live555 Source code analysis: DESCRIBE processing</a></li><ul><li><span class="title-icon "></span><a href="#createfind-servermediasession"><b>1.1. </b>Create/Find ServerMediaSession</a></li><li><span class="title-icon "></span><a href="#generate-an-sdp-message"><b>1.2. </b>Generate an SDP message</a></li><li><span class="title-icon "></span><a href="#live555-source-code-analysis-series"><b>1.3. </b>Live555 source code analysis series</a></li></ul></ul></div><a href="#live555-source-code-analysis-describe-processing" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="live555-source-code-analysis-describe-processing"><a name="live555-source-code-analysis-describe-processing" class="anchor-navigation-ex-anchor" href="#live555-source-code-analysis-describe-processing"><i class="fa fa-link" aria-hidden="true"></i></a>1. Live555 Source code analysis: DESCRIBE processing</h1>
<p> Posted on 2017-09-04 |  In <a href="https://www.wolfcstech.com/categories/live555/" target="_blank">live555</a></p>
<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:0 orderedList:0 -->
<ul>
<li><a href="#live555-source-code-analysis-describe-processing"><strong>Live555 Source code analysis: DESCRIBE processing</strong></a><ul>
<li><a href="#createfind-servermediasession"><strong>Create/Find ServerMediaSession</strong></a></li>
<li><a href="#generate-an-sdp-message"><strong>Generate an SDP message</strong></a></li>
<li><a href="#live555-source-code-analysis-series"><strong>Live555 source code analysis series</strong></a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<p>In the <a href="http://www.jianshu.com/p/62387ac1fe41" target="_blank">live555 source code analysis:
RTSPServer</a> analyzes the general process
of processing RTSP requests in live555, and analyzes some methods that are not
so complicated to deal with, such as <code>OPTIONS</code>, <code>GET_PARAMETER</code> and
so <code>SET_PARAMETER</code> on. Limited space, there is no analysis of the most
important <code>DESCRIBE</code>, <code>SETUP</code> and <code>PLAY</code> deal with these methods.</p>
<p>This article continues the analysis live555 of RTSP requests,
analysis <code>DESCRIBE</code>, <code>SETUP</code> and <code>PLAY</code> of these the most important methods of
treatment.</p>
<p>in</p>
<p><code>RTSPServer::RTSPClientConnection::handleRequestBytes(int newBytesRead)</code> By
calling <code>handleCmd_DESCRIBE()</code> function processing <code>DESCRIBE</code> request, as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">} else if (strcmp(cmdName, &quot;DESCRIBE&quot;) == 0) {
  handleCmd_DESCRIBE(urlPreSuffix, urlSuffix,
      (char const*) fRequestBuffer);
}<br></div></div>


<p><code>handleCmd_DESCRIBE()</code> The definition of a function is like this:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">void RTSPServer::RTSPClientConnection
::handleCmd_DESCRIBE(char const* urlPreSuffix, char const* urlSuffix, char const* fullRequestStr) {
  ServerMediaSession* session = NULL;
  char* sdpDescription = NULL;
  char* rtspURL = NULL;
  do {
    char urlTotalSuffix[2*RTSP_PARAM_STRING_MAX];
        // enough space for urlPreSuffix/urlSuffix&apos;\0&apos;
    urlTotalSuffix[0] = &apos;\0&apos;;
    if (urlPreSuffix[0] != &apos;\0&apos;) {
      strcat(urlTotalSuffix, urlPreSuffix);
      strcat(urlTotalSuffix, &quot;/&quot;);
    }
    strcat(urlTotalSuffix, urlSuffix);

    if (!authenticationOK(&quot;DESCRIBE&quot;, urlTotalSuffix, fullRequestStr)) break;

    // We should really check that the request contains an &quot;Accept:&quot; #####
    // for &quot;application/sdp&quot;, because that&apos;s what we&apos;re sending back #####

    // Begin by looking up the &quot;ServerMediaSession&quot; object for the specified &quot;urlTotalSuffix&quot;:
    session = fOurServer.lookupServerMediaSession(urlTotalSuffix);
    if (session == NULL) {
      handleCmd_notFound();
      break;
    }

    // Increment the &quot;ServerMediaSession&quot; object&apos;s reference count, in case someone removes it
    // while we&apos;re using it:
    session-&gt;incrementReferenceCount();
    // Then, assemble a SDP description for this session:
    sdpDescription = session-&gt;generateSDPDescription();
    if (sdpDescription == NULL) {
      // This usually means that a file name that was specified for a
      // &quot;ServerMediaSubsession&quot; does not exist.
      setRTSPResponse(&quot;404 File Not Found, Or In Incorrect Format&quot;);
      break;
    }
    unsigned sdpDescriptionSize = strlen(sdpDescription);

    // Also, generate our RTSP URL, for the &quot;Content-Base:&quot; header
    // (which is necessary to ensure that the correct URL gets used in subsequent &quot;SETUP&quot; requests).
    rtspURL = fOurRTSPServer.rtspURL(session, fClientInputSocket);
    snprintf((char*) fResponseBuffer, sizeof fResponseBuffer,
        &quot;RTSP/1.0 200 OK\r\nCSeq: %s\r\n&quot;
        &quot;%s&quot;
        &quot;Content-Base: %s/\r\n&quot;
        &quot;Content-Type: application/sdp\r\n&quot;
        &quot;Content-Length: %d\r\n\r\n&quot;
        &quot;%s&quot;,
        fCurrentCSeq,
        dateHeader(),
        rtspURL,
        sdpDescriptionSize,
        sdpDescription);
  } while (0);

  if (session != NULL) {
    // Decrement its reference count, now that we&apos;re done using it:
    session-&gt;decrementReferenceCount();
    if (session-&gt;referenceCount() == 0 &amp;&amp; session-&gt;deleteWhenUnreferenced()) {
      fOurServer.removeServerMediaSession(session);
    }
  }
  delete[] sdpDescription;
  delete[] rtspURL;
}<br></div></div>

<p><code>handleCmd_DESCRIBE()</code> Function by a do-while (0) of the structure to
achieve <code>DESCRIBE</code> the processing method. The advantage of the do-while(0)
structure is probably that, in the event of an error, there is no need to return
directly, messing up the control flow, and jumping to the end of the function
without the goto statement.</p>
<p>This function is in <code>DESCRIBE</code> operation the whole execution process: </p>
<ol>
<li><p>First of execution on the URL <code>DESCRIBE</code> certification authority operations,
&quot;LIVE555 Media Server&quot; does not provide authentication, authentication will
always be successful.</p>
</li>
<li><p>Find or create a <code>ServerMediaSession</code> structure for operating the meta
information of the media stream. The search is based on the path of the
resource in the URL. For &quot;LIVE555 Media Server&quot;, it is also the relative
path of the corresponding file relative to the directory running on the
server. When the function fails to execute, it will directly return 404 to
the client:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">void RTSPServer::RTSPClientConnection::handleCmd_notFound() {
    setRTSPResponse(&quot;404 Stream Not Found&quot;);
  }<br></div></div>
</li>
<li><p>Generate an SDP description. On failure, it also returns a 404 failure to
the client.</p>
</li>
<li><p>Get the RTSP URL. The RTSP URL is spliced &#x200B;&#x200B;by the server&apos;s IP address and URL
path:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">char* RTSPServer
  ::rtspURL(ServerMediaSession const* serverMediaSession, int clientSocket) const {
    char* urlPrefix = rtspURLPrefix(clientSocket);
    char const* sessionName = serverMediaSession-&gt;streamName();

    char* resultURL = new char[strlen(urlPrefix) + strlen(sessionName) + 1];
    sprintf(resultURL, &quot;%s%s&quot;, urlPrefix, sessionName);

    delete[] urlPrefix;
    return resultURL;
  }
  char* RTSPServer::rtspURLPrefix(int clientSocket) const {
    struct sockaddr_in ourAddress;
    if (clientSocket &lt; 0) {
      // Use our default IP address in the URL:
      ourAddress.sin_addr.s_addr = ReceivingInterfaceAddr != 0
        ? ReceivingInterfaceAddr
        : ourIPAddress(envir()); // hack
    } else {
      SOCKLEN_T namelen = sizeof ourAddress;
      getsockname(clientSocket, (struct sockaddr*)&amp;ourAddress, &amp;namelen);
    }

    char urlBuffer[100]; // more than big enough for &quot;rtsp://&lt;ip-address&gt;:&lt;port&gt;/&quot;

    portNumBits portNumHostOrder = ntohs(fServerPort.num());
    if (portNumHostOrder == 554 /* the default port number */) {
      sprintf(urlBuffer, &quot;rtsp://%s/&quot;, AddressString(ourAddress).val());
    } else {
      sprintf(urlBuffer, &quot;rtsp://%s:%hu/&quot;,
          AddressString(ourAddress).val(), portNumHostOrder);
    }
    return strDup(urlBuffer);
  }<br></div></div></li>
<li>Generate a response message.</li>
</ol>
<p>In the <code>DESCRIBE</code> request, the client can through <code>Accept</code> the server shows that what
the media streaming session supports the following way, but in live555, it seems
is to identify the client requests only SDP, and therefore the whole process all
manner of produce SDP media stream get on. The SDP message is placed in the body
of the response message.</p>
<h2 id="createfind-servermediasession"><a name="createfind-servermediasession" class="anchor-navigation-ex-anchor" href="#createfind-servermediasession"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. Create/Find ServerMediaSession</h2>
<p><code>handleCmd_DESCRIBE()</code> By function <code>lookupServerMediaSession()</code> to find or create
a <code>ServerMediaSession</code> structure, the function <code>GenericMediaServer</code> declaration class:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">virtual ServerMediaSession*
lookupServerMediaSession(char const* streamName, Boolean isFirstLookupInSession = True);<br></div></div>


<p>It is a virtual function, and the actual function implementation called is
located in the lowest level class that implements the function in the
inheritance
hierarchy. For <code>DynamicRTSPServer -&gt; RTSPServerSupportingHTTPStreaming -&gt; RTSPServer -&gt; GenericMediaServer</code> this
inheritance hierarchy, class implements this method
has <code>DynamicRTSPServer</code> and <code>GenericMediaServer</code>. Here to see <code>DynamicRTSPServer</code> the
class implementation:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">ServerMediaSession* DynamicRTSPServer
::lookupServerMediaSession(char const* streamName, Boolean isFirstLookupInSession) {
  // First, check whether the specified &quot;streamName&quot; exists as a local file:
  FILE* fid = fopen(streamName, &quot;rb&quot;);
  Boolean fileExists = fid != NULL;
  // Next, check whether we already have a &quot;ServerMediaSession&quot; for this file:
  ServerMediaSession* sms = RTSPServer::lookupServerMediaSession(streamName);
  Boolean smsExists = sms != NULL;
  // Handle the four possibilities for &quot;fileExists&quot; and &quot;smsExists&quot;:
  if (!fileExists) {
    if (smsExists) {
      // &quot;sms&quot; was created for a file that no longer exists. Remove it:
      removeServerMediaSession(sms);
      sms = NULL;
    }
    return NULL;
  } else {
    if (smsExists &amp;&amp; isFirstLookupInSession) {
      // Remove the existing &quot;ServerMediaSession&quot; and create a new one, in case the underlying
      // file has changed in some way:
      removeServerMediaSession(sms);
      sms = NULL;
    }
    if (sms == NULL) {
      sms = createNewSMS(envir(), streamName, fid);
      addServerMediaSession(sms);
    }
    fclose(fid);
    return sms;
  }
}<br></div></div>


<p><code>DynamicRTSPServer::lookupServerMediaSession()</code> First checks whether the
corresponding file exists, the file and find the corresponding parent class
by <code>ServerMediaSession</code> whether the existing structure. The method of the parent
class in <code>GenericMediaServer</code> the definition of the class is as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">ServerMediaSession* GenericMediaServer
::lookupServerMediaSession(char const* streamName, Boolean /*isFirstLookupInSession*/) {
  // Default implementation:
  return (ServerMediaSession*)(fServerMediaSessions-&gt;Lookup(streamName));
}<br></div></div>

<p>Then according to the results of the inspection and search, it is divided into
several cases:</p>
<ol>
<li><p>File does not exist, the corresponding <code>ServerMediaSession</code> structure already
exists -&gt; Remove <code>ServerMediaSession</code> structure, returned <code>NULL</code> to the caller.</p>
</li>
<li><p>File does not exist, the corresponding <code>ServerMediaSession</code> structure does not
exist -&gt; returns <code>NULL</code> to the caller.</p>
</li>
<li><p>File exists, <code>ServerMediaSession</code> there is structure, and is the first
streaming media session in a Find -&gt; Remove <code>ServerMediaSession</code> structure,
and create a new structure, saved, and returns it to the caller.</p>
</li>
<li><p>The file exists, (the <code>ServerMediaSession</code> structure exists, but not the first
lookup in the streaming session) or (the <code>ServerMediaSession</code> structure does
not exist) -&gt; Create a new <code>ServerMediaSession</code> structure, save it, and return it to the caller.</p>
</li>
</ol>
<p>For the <code>DESCRIBE</code> purposes of the method, this time streaming media sessions
usually are not established, and therefore will always find the first execution
flow.</p>
<p>Create a new <code>ServerMediaSession</code> being to <code>createNewSMS()</code> be done:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">#define NEW_SMS(description) do {\
char const* descStr = description\
    &quot;, streamed by the LIVE555 Media Server&quot;;\
sms = ServerMediaSession::createNew(env, fileName, fileName, descStr);\
} while(0)
static ServerMediaSession* createNewSMS(UsageEnvironment&amp; env,
                    char const* fileName, FILE* /*fid*/) {
  // Use the file name extension to determine the type of &quot;ServerMediaSession&quot;:
  char const* extension = strrchr(fileName, &apos;.&apos;);
  if (extension == NULL) return NULL;
  ServerMediaSession* sms = NULL;
  Boolean const reuseSource = False;
. . . . . .
  } else if (strcmp(extension, &quot;.264&quot;) == 0) {
    // Assumed to be a H.264 Video Elementary Stream file:
    NEW_SMS(&quot;H.264 Video&quot;);
    OutPacketBuffer::maxSize = 100000; // allow for some possibly large H.264 frames
    sms-&gt;addSubsession(H264VideoFileServerMediaSubsession::createNew(env, fileName, reuseSource));
  } else if (strcmp(extension, &quot;.265&quot;) == 0) {
. . . . . .
  return sms;
}<br></div></div>


<p><code>createNewSMS()</code> Created based on the file
extension <code>ServerMediaSession</code> structure. We look H.264 video
format <code>ServerMediaSession</code> to create a structure.</p>
<p><code>createNewSMS()</code> Create a macro <code>ServerMediaSession</code> structure, the macro by the (0)
do-while <code>ServerMediaSession::createNew()</code> created; the output buffer is set to
100000 bytes; creating type <code>H264VideoFileServerMediaSubsession</code> of <code>ServerMediaSubsession</code> and provided to
the <code>ServerMediaSession</code> structure; and then <code>ServerMediaSession</code> returns to the
caller structure.</p>
<p><em>Note that the output buffer limits the size of one frame in the video stream.
For some video streams with higher resolution, this size may not meet the
requirements. For example, 1080P video stream, some frame sizes may exceed
100000, reaching 150,000. ,even more.</em></p>
<p><code>ServerMediaSession::createNew()</code> The definition is as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">ServerMediaSession* ServerMediaSession
::createNew(UsageEnvironment&amp; env,
        char const* streamName, char const* info,
        char const* description, Boolean isSSM, char const* miscSDPLines) {
  return new ServerMediaSession(env, streamName, info, description,
                isSSM, miscSDPLines);
}
. . . . . .
ServerMediaSession::ServerMediaSession(UsageEnvironment&amp; env,
                       char const* streamName,
                       char const* info,
                       char const* description,
                       Boolean isSSM, char const* miscSDPLines)
  : Medium(env), fIsSSM(isSSM), fSubsessionsHead(NULL),
    fSubsessionsTail(NULL), fSubsessionCounter(0),
    fReferenceCount(0), fDeleteWhenUnreferenced(False) {
  fStreamName = strDup(streamName == NULL ? &quot;&quot; : streamName);
  char* libNamePlusVersionStr = NULL; // by default
  if (info == NULL || description == NULL) {
    libNamePlusVersionStr = new char[strlen(libNameStr) + strlen(libVersionStr) + 1];
    sprintf(libNamePlusVersionStr, &quot;%s%s&quot;, libNameStr, libVersionStr);
  }
  fInfoSDPString = strDup(info == NULL ? libNamePlusVersionStr : info);
  fDescriptionSDPString = strDup(description == NULL ? libNamePlusVersionStr : description);
  delete[] libNamePlusVersionStr;
  fMiscSDPLines = strDup(miscSDPLines == NULL ? &quot;&quot; : miscSDPLines);
  gettimeofday(&amp;fCreationTime, NULL);
}<br></div></div>


<p><code>ServerMediaSession</code> It is <code>ServerMediaSubsession</code> organized as a singly linked list.</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">Boolean
ServerMediaSession::addSubsession(ServerMediaSubsession* subsession) {
  if (subsession-&gt;fParentSession != NULL) return False; // it&apos;s already used
  if (fSubsessionsTail == NULL) {
    fSubsessionsHead = subsession;
  } else {
    fSubsessionsTail-&gt;fNext = subsession;
  }
  fSubsessionsTail = subsession;
  subsession-&gt;fParentSession = this;
  subsession-&gt;fTrackNumber = ++fSubsessionCounter;
  return True;
}<br></div></div>


<p>Newly added <code>ServerMediaSubsession</code> will always be placed at the end of the list.</p>
<h2 id="generate-an-sdp-message"><a name="generate-an-sdp-message" class="anchor-navigation-ex-anchor" href="#generate-an-sdp-message"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. Generate an SDP message</h2>
<p>SDP message by the <code>ServerMediaSession</code> generated:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">float ServerMediaSession::duration() const {
  float minSubsessionDuration = 0.0;
  float maxSubsessionDuration = 0.0;
  for (ServerMediaSubsession* subsession = fSubsessionsHead; subsession != NULL;
       subsession = subsession-&gt;fNext) {
    // Hack: If any subsession supports seeking by &apos;absolute&apos; time, then return a negative value, to indicate that only subsessions
    // will have a &quot;a=range:&quot; attribute:
    char* absStartTime = NULL; char* absEndTime = NULL;
    subsession-&gt;getAbsoluteTimeRange(absStartTime, absEndTime);
    if (absStartTime != NULL) return -1.0f;
    float ssduration = subsession-&gt;duration();
    if (subsession == fSubsessionsHead) { // this is the first subsession
      minSubsessionDuration = maxSubsessionDuration = ssduration;
    } else if (ssduration &lt; minSubsessionDuration) {
      minSubsessionDuration = ssduration;
    } else if (ssduration &gt; maxSubsessionDuration) {
      maxSubsessionDuration = ssduration;
    }
  }
  if (maxSubsessionDuration != minSubsessionDuration) {
    return -maxSubsessionDuration; // because subsession durations differ
  } else {
    return maxSubsessionDuration; // all subsession durations are the same
  }
}
. . . . . .
char* ServerMediaSession::generateSDPDescription() {
  AddressString ipAddressStr(ourIPAddress(envir()));
  unsigned ipAddressStrSize = strlen(ipAddressStr.val());
  // For a SSM sessions, we need a &quot;a=source-filter: incl ...&quot; line also:
  char* sourceFilterLine;
  if (fIsSSM) {
    char const* const sourceFilterFmt =
      &quot;a=source-filter: incl IN IP4 * %s\r\n&quot;
      &quot;a=rtcp-unicast: reflection\r\n&quot;;
    unsigned const sourceFilterFmtSize = strlen(sourceFilterFmt) + ipAddressStrSize + 1;
    sourceFilterLine = new char[sourceFilterFmtSize];
    sprintf(sourceFilterLine, sourceFilterFmt, ipAddressStr.val());
  } else {
    sourceFilterLine = strDup(&quot;&quot;);
  }
  char* rangeLine = NULL; // for now
  char* sdp = NULL; // for now
  do {
    // Count the lengths of each subsession&apos;s media-level SDP lines.
    // (We do this first, because the call to &quot;subsession-&gt;sdpLines()&quot;
    // causes correct subsession &apos;duration()&apos;s to be calculated later.)
    unsigned sdpLength = 0;
    ServerMediaSubsession* subsession;
    for (subsession = fSubsessionsHead; subsession != NULL; subsession = subsession-&gt;fNext) {
      char const* sdpLines = subsession-&gt;sdpLines();
      if (sdpLines == NULL) continue; // the media&apos;s not available
      sdpLength += strlen(sdpLines);
    }
    if (sdpLength == 0) break; // the session has no usable subsessions
    // Unless subsessions have differing durations, we also have a &quot;a=range:&quot; line:
    float dur = duration();
    if (dur == 0.0) {
      rangeLine = strDup(&quot;a=range:npt=0-\r\n&quot;);
    } else if (dur &gt; 0.0) {
      char buf[100];
      sprintf(buf, &quot;a=range:npt=0-%.3f\r\n&quot;, dur);
      rangeLine = strDup(buf);
    } else { // subsessions have differing durations, so &quot;a=range:&quot; lines go there
      rangeLine = strDup(&quot;&quot;);
    }
    char const* const sdpPrefixFmt =
      &quot;v=0\r\n&quot;
      &quot;o=- %ld%06ld %d IN IP4 %s\r\n&quot;
      &quot;s=%s\r\n&quot;
      &quot;i=%s\r\n&quot;
      &quot;t=0 0\r\n&quot;
      &quot;a=tool:%s%s\r\n&quot;
      &quot;a=type:broadcast\r\n&quot;
      &quot;a=control:*\r\n&quot;
      &quot;%s&quot;
      &quot;%s&quot;
      &quot;a=x-qt-text-nam:%s\r\n&quot;
      &quot;a=x-qt-text-inf:%s\r\n&quot;
      &quot;%s&quot;;
    sdpLength += strlen(sdpPrefixFmt)
      + 20 + 6 + 20 + ipAddressStrSize
      + strlen(fDescriptionSDPString)
      + strlen(fInfoSDPString)
      + strlen(libNameStr) + strlen(libVersionStr)
      + strlen(sourceFilterLine)
      + strlen(rangeLine)
      + strlen(fDescriptionSDPString)
      + strlen(fInfoSDPString)
      + strlen(fMiscSDPLines);
    sdpLength += 1000; // in case the length of the &quot;subsession-&gt;sdpLines()&quot; calls below change
    sdp = new char[sdpLength];
    if (sdp == NULL) break;
    // Generate the SDP prefix (session-level lines):
    snprintf(sdp, sdpLength, sdpPrefixFmt, fCreationTime.tv_sec,
        fCreationTime.tv_usec, // o= &lt;session id&gt;
        1, // o= &lt;version&gt; // (needs to change if params are modified)
        ipAddressStr.val(), // o= &lt;address&gt;
        fDescriptionSDPString, // s= &lt;description&gt;
        fInfoSDPString, // i= &lt;info&gt;
        libNameStr, libVersionStr, // a=tool:
        sourceFilterLine, // a=source-filter: incl (if a SSM session)
        rangeLine, // a=range: line
        fDescriptionSDPString, // a=x-qt-text-nam: line
        fInfoSDPString, // a=x-qt-text-inf: line
        fMiscSDPLines); // miscellaneous session SDP lines (if any)
    // Then, add the (media-level) lines for each subsession:
    char* mediaSDP = sdp;
    for (subsession = fSubsessionsHead; subsession != NULL; subsession =
        subsession-&gt;fNext) {
      unsigned mediaSDPLength = strlen(mediaSDP);
      mediaSDP += mediaSDPLength;
      sdpLength -= mediaSDPLength;
      if (sdpLength &lt;= 1)
        break; // the SDP has somehow become too long
      char const* sdpLines = subsession-&gt;sdpLines();
      if (sdpLines != NULL)
        snprintf(mediaSDP, sdpLength, &quot;%s&quot;, sdpLines);
    }
  } while (0);
  delete[] rangeLine; delete[] sourceFilterLine;
  return sdp;
}<br></div></div>

<p>The SDP message mainly includes two pieces of content, one is the general SDP
message content, which mainly includes the timestamp, the server IP address, the
duration, etc., and the other is the sub-session-specific information in the
streaming media session.</p>
<p>For the following SDP messages:</p>
<pre><code>v=0
o=- 1504342443358944 1 IN IP4 10.240.248.20
s=H.264 Video, streamed by the LIVE555 Media Server
i=video/raw_h264_stream.264
t=0 0
a=tool:LIVE555 Streaming Media v2017.07.18
a=type:broadcast
a=control:*
a=range:npt=0-
a=x-qt-text-nam:H.264 Video, streamed by the LIVE555 Media Server
a=x-qt-text-inf:video/raw_h264_stream.264
m=video 0 RTP/AVP 96
c=IN IP4 0.0.0.0
b=AS:500
a=rtpmap:96 H264/90000
a=fmtp:96 packetization-mode=1;profile-level-id=42802A;sprop-parameter-sets=Z0KAKtoBEA8eXlIKDAoNoUJq,aM4G4g==
a=control:track1
</code></pre><p>The general SDP message content is:</p>
<pre><code>v=0
o=- 1504342443358944 1 IN IP4 10.240.248.20
s=H.264 Video, streamed by the LIVE555 Media Server
i=video/raw_h264_stream.264
t=0 0
a=tool:LIVE555 Streaming Media v2017.07.18
a=type:broadcast
a=control:*
a=range:npt=0-
a=x-qt-text-nam:H.264 Video, streamed by the LIVE555 Media Server
a=x-qt-text-inf:video/raw_h264_stream.264
</code></pre><p>The content generated by the H.264 streaming file is:</p>
<pre><code>m=video 0 RTP/AVP 96
c=IN IP4 0.0.0.0
b=AS:500
a=rtpmap:96 H264/90000
a=fmtp:96 packetization-mode=1;profile-level-id=42802A;sprop-parameter-sets=Z0KAKtoBEA8eXlIKDAoNoUJq,aM4G4g==
a=control:track1
</code></pre><p>The SDP message for the child session comes <code>from ServerMediaSubsession::sdpLines()</code>,
it is declared as a pure virtual function:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">class ServerMediaSubsession: public Medium {
public:
  unsigned trackNumber() const { return fTrackNumber; }
  char const* trackId();
  virtual char const* sdpLines() = 0;<br></div></div>


<p>For H.264 streaming sub-session we created a
document, <code>ServerMediaSubsession</code> as <code>H264VideoFileServerMediaSubsession</code> it has
inherited system as shown below:</p>
<p>     <a href="media/43b7618c41c759076045a61bff481a21.png" rel="grouped" title="https://www.wolfcstech.com/images/1315506-912929536d7c724f.png" target="_self" class="fancybox">
       <img src="media/43b7618c41c759076045a61bff481a21.png" alt="https://www.wolfcstech.com/images/1315506-912929536d7c724f.png">
     </a></p>
<p>As you can see from the figure, the SDP content specific to H.264 streaming
sub-sessions will come from <code>OnDemandServerMediaSubsession::sdpLines()</code>:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">char const*
OnDemandServerMediaSubsession::sdpLines() {
  if (fSDPLines == NULL) {
    // We need to construct a set of SDP lines that describe this
    // subsession (as a unicast stream).  To do so, we first create
    // dummy (unused) source and &quot;RTPSink&quot; objects,
    // whose parameters we use for the SDP lines:
    unsigned estBitrate;
    FramedSource* inputSource = createNewStreamSource(0, estBitrate);
    if (inputSource == NULL) return NULL; // file not found
    struct in_addr dummyAddr;
    dummyAddr.s_addr = 0;
    Groupsock* dummyGroupsock = createGroupsock(dummyAddr, 0);
    unsigned char rtpPayloadType = 96 + trackNumber()-1; // if dynamic
    RTPSink* dummyRTPSink = createNewRTPSink(dummyGroupsock, rtpPayloadType, inputSource);
    if (dummyRTPSink != NULL &amp;&amp; dummyRTPSink-&gt;estimatedBitrate() &gt; 0) estBitrate = dummyRTPSink-&gt;estimatedBitrate();
    setSDPLinesFromRTPSink(dummyRTPSink, inputSource, estBitrate);
    Medium::close(dummyRTPSink);
    delete dummyGroupsock;
    closeStreamSource(inputSource);
  }
  return fSDPLines;
}<br></div></div>

<p>In this function, in order to construct the line SDP session descriptor, it
first creates a temporary <code>FramedSource</code> and <code>RTPSink</code> then get information from these
structures to construct the SDP line, and in the final destruction of
temporary <code>FramedSource</code> and <code>RTPSink</code>.</p>
<p>The process of constructing an SDP line is as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">float ServerMediaSubsession::duration() const {
  // default implementation: assume an unbounded session:
  return 0.0;
}
void ServerMediaSubsession::getAbsoluteTimeRange(char*&amp; absStartTime, char*&amp; absEndTime) const {
  // default implementation: We don&apos;t support seeking by &apos;absolute&apos; time, so indicate this by setting both parameters to NULL:
  absStartTime = absEndTime = NULL;
}
void ServerMediaSubsession::setServerAddressAndPortForSDP(netAddressBits addressBits,
                              portNumBits portBits) {
  fServerAddressForSDP = addressBits;
  fPortNumForSDP = portBits;
}
void OnDemandServerMediaSubsession
::setSDPLinesFromRTPSink(RTPSink* rtpSink, FramedSource* inputSource, unsigned estBitrate) {
  if (rtpSink == NULL) return;
  char const* mediaType = rtpSink-&gt;sdpMediaType();
  unsigned char rtpPayloadType = rtpSink-&gt;rtpPayloadType();
  AddressString ipAddressStr(fServerAddressForSDP);
  char* rtpmapLine = rtpSink-&gt;rtpmapLine();
  char const* rtcpmuxLine = fMultiplexRTCPWithRTP ? &quot;a=rtcp-mux\r\n&quot; : &quot;&quot;;
  char const* rangeLine = rangeSDPLine();
  char const* auxSDPLine = getAuxSDPLine(rtpSink, inputSource);
  if (auxSDPLine == NULL) auxSDPLine = &quot;&quot;;
  char const* const sdpFmt =
    &quot;m=%s %u RTP/AVP %d\r\n&quot;
    &quot;c=IN IP4 %s\r\n&quot;
    &quot;b=AS:%u\r\n&quot;
    &quot;%s&quot;
    &quot;%s&quot;
    &quot;%s&quot;
    &quot;%s&quot;
    &quot;a=control:%s\r\n&quot;;
  unsigned sdpFmtSize = strlen(sdpFmt)
    + strlen(mediaType) + 5 /* max short len */ + 3 /* max char len */
    + strlen(ipAddressStr.val())
    + 20 /* max int len */
    + strlen(rtpmapLine)
    + strlen(rtcpmuxLine)
    + strlen(rangeLine)
    + strlen(auxSDPLine)
    + strlen(trackId());
  char* sdpLines = new char[sdpFmtSize];
  sprintf(sdpLines, sdpFmt, mediaType, // m= &lt;media&gt;
      fPortNumForSDP, // m= &lt;port&gt;
      rtpPayloadType, // m= &lt;fmt list&gt;
      ipAddressStr.val(), // c= address
      estBitrate, // b=AS:&lt;bandwidth&gt;
      rtpmapLine, // a=rtpmap:... (if present)
      rtcpmuxLine, // a=rtcp-mux:... (if present)
      rangeLine, // a=range:... (if present)
      auxSDPLine, // optional extra SDP line
      trackId()); // a=control:&lt;track-id&gt;
  delete[] (char*) rangeLine;
  delete[] rtpmapLine;
  fSDPLines = strDup(sdpLines);
  delete[] sdpLines;
}<br></div></div>

<p>Create a temporary <code>FramedSource</code> and <code>RTPSink</code> functions are pure virtual function:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">virtual FramedSource* createNewStreamSource(unsigned clientSessionId,
    unsigned&amp; estBitrate) = 0;
// &quot;estBitrate&quot; is the stream&apos;s estimated bitrate, in kbps
virtual RTPSink* createNewRTPSink(Groupsock* rtpGroupsock,
    unsigned char rtpPayloadTypeIfDynamic,
    FramedSource* inputSource) = 0;<br></div></div>


<p>For the <code>H264VideoFileServerMediaSubsession</code> class inheritance hierarchy, to
achieve these two functions are in <code>H264VideoFileServerMediaSubsession</code> class:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">FramedSource* H264VideoFileServerMediaSubsession::createNewStreamSource(unsigned /*clientSessionId*/, unsigned&amp; estBitrate) {
  estBitrate = 500; // kbps, estimate
  // Create the video source:
  ByteStreamFileSource* fileSource = ByteStreamFileSource::createNew(envir(), fFileName);
  if (fileSource == NULL) return NULL;
  fFileSize = fileSource-&gt;fileSize();
  // Create a framer for the Video Elementary Stream:
  return H264VideoStreamFramer::createNew(envir(), fileSource);
}
RTPSink* H264VideoFileServerMediaSubsession::createNewRTPSink(
    Groupsock* rtpGroupsock,
    unsigned char rtpPayloadTypeIfDynamic,
    FramedSource* /*inputSource*/) {
  return H264VideoRTPSink::createNew(envir(), rtpGroupsock, rtpPayloadTypeIfDynamic);
}<br></div></div>


<p>Actually created <code>FramedSource</code> and <code>RTPSink</code> type respectively <code>H264VideoStreamFramer</code> and <code>H264VideoRTPSink</code>.</p>
<p><a href="https://www.wolfcstech.com/about/donate.html" target="_blank">Reward</a></p>
<p>Done.</p>
<h2 id="live555-source-code-analysis-series"><a name="live555-source-code-analysis-series" class="anchor-navigation-ex-anchor" href="#live555-source-code-analysis-series"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Live555 source code analysis series</h2>
<ol>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_introduction.html">Live555 Source code analysis: Introduction </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_infrastructure.html">live555 Source code analysis: Infrastructure </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_mediaserver.html">live555 Source code analysis: MediaSever </a></li>
<li><a href="Live555%20-%20Wireshark%20capture%20packet%20analysis%20RTSP_RTP_RTCP%20basic%20working%20process.html">Wireshark capture packet analysis RTSP/RTP/RTCP Basic working process </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_rtspserver.html">live555 Source code analysis: RTSPServer </a></li>
<li><a href="https://www.wolfcstech.com/2017/09/04/live555_src_analysis_describe/" target="_blank">live555 Source code analysis: DESCRIBE processing </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_setup%20processing.html">live555 Source code analysis: SETUP processing </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_play%20processing.html">live555 Source code analysis :PLAY processing </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_RTSPServer%20component%20structure.html">live555 Source code analysis: RTSPServer component structure </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_servermediasession.html">live555 Source code analysis: </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_subsession%20SDP%20line%20generation.html">ServerMediaSession live555 Source code analysis: sub-session SDP line generation </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_Subsession%20SETUP.html">live555 Source code analysis: sub-session SETUP </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_play%20start.html">live555 Source code analysis: play start</a></li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Live555 - Live555 source code analysis_rtspserver.html" class="navigation navigation-prev " aria-label="Previous page: Live555 - Live555 source code analysis_rtspserver">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Live555 - Live555 source code analysis_setup processing.html" class="navigation navigation-next " aria-label="Next page: Live555 - Live555 source code analysis_setup processing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Live555 - Live555 source code analysis_describe processing","level":"1.10.6","depth":2,"next":{"title":"Live555 - Live555 source code analysis_setup processing","level":"1.10.7","depth":2,"path":"Live555 - Live555 source code analysis_setup processing.md","ref":"Live555 - Live555 source code analysis_setup processing.md","articles":[]},"previous":{"title":"Live555 - Live555 source code analysis_rtspserver","level":"1.10.5","depth":2,"path":"Live555 - Live555 source code analysis_rtspserver.md","ref":"Live555 - Live555 source code analysis_rtspserver.md","articles":[]},"dir":"ltr"},"config":{"plugins":["include-html","fancybox","anchor-navigation-ex-toc","ace","-lunr","-search","search-plus","hide-published-with","splitter","expandable-chapters-interactive","wide-page"],"root":"./docs","styles":{"website":"styles/website.css"},"pluginsConfig":{"fancybox":{"helpers":{"buttons":{}}},"ace":{},"splitter":{},"wide-page":{},"anchor-navigation-ex-toc":{"showLevel":true,"associatedWithSummary":true,"mode":"float","printLog":false,"multipleH1":true,"float":{"showLevelIcon":false,"level1Icon":"","level2Icon":"","level3Icon":""},"pageTop":{"showLevelIcon":false,"level1Icon":"","level2Icon":"","level3Icon":""}},"hide-published-with":{},"include-html":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"expandable-chapters-interactive":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{},"search-plus":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"Live555 - Live555 source code analysis_describe processing.md","mtime":"2019-03-05T06:19:16.311Z","type":"markdown"},"gitbook":{"version":"3.3.6","time":"2023-12-10T09:35:29.798Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-hide-published-with/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-expandable-chapters-interactive/expandable-chapters.js"></script>
        
    
        
        <script src="gitbook/@gitbook-ng/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

