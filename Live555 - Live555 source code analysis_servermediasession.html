
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Live555 - Live555 source code analysis_servermediasession Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="@gitbook-ng/gitbook 3.3.6">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchor-navigation-ex-toc/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-expandable-chapters-interactive/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Live555 - Live555 source code analysis_subsession SDP line generation.html" />
    
    
    <link rel="prev" href="Live555 - Live555 source code analysis_RTSPServer component structure.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Graphical Android
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="Graphical Android - Zygote, System Server startup analysis.html">
            
                <a href="Graphical Android - Zygote, System Server startup analysis.html">
            
                    
                    Graphical Android - Zygote, System Server startup analysis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Android Permissions
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="Android Permissions - Android Runtime Permission.html">
            
                <a href="Android Permissions - Android Runtime Permission.html">
            
                    
                    Android Permissions - Android Runtime Permission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Android Permissions - Android grantRuntimePermission Detailed.html">
            
                <a href="Android Permissions - Android grantRuntimePermission Detailed.html">
            
                    
                    Android Permissions - Android grantRuntimePermission Detailed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="Android Permissions - Android GrantPermissionsActivity Detailed.html">
            
                <a href="Android Permissions - Android GrantPermissionsActivity Detailed.html">
            
                    
                    Android Permissions - Android GrantPermissionsActivity Detailed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="Android Permissions - AppOps control for Normal permission.html">
            
                <a href="Android Permissions - AppOps control for Normal permission.html">
            
                    
                    Android Permissions - AppOps control for Normal permission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="Android Permissions - Android native permission control process.html">
            
                <a href="Android Permissions - Android native permission control process.html">
            
                    
                    Android Permissions - Android native permission control process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="Android Permissions - The difference between setUidMode and setMode in AppOps.html">
            
                <a href="Android Permissions - The difference between setUidMode and setMode in AppOps.html">
            
                    
                    Android Permissions - The difference between setUidMode and setMode in AppOps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="Android Permissions - Application permissions before android M and application permissions after M.html">
            
                <a href="Android Permissions - Application permissions before android M and application permissions after M.html">
            
                    
                    Android Permissions - Application permissions before android M and application permissions after M
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="Android Permissions - Provider permissions detailed.html">
            
                <a href="Android Permissions - Provider permissions detailed.html">
            
                    
                    Android Permissions - Provider permissions detailed
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Android OTA
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="Android OTA - Android OTA upgrade principle and process analysis 1.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 1.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="Android OTA - Android OTA upgrade principle and process analysis 2.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 2.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="Android OTA - Android OTA upgrade principle and process analysis 3.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 3.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="Android OTA - Android OTA upgrade principle and process analysis 4.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 4.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="Android OTA - Android OTA upgrade principle and process analysis 5.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 5.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="Android OTA - Android OTA upgrade principle and process analysis 6.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 6.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="Android OTA - Android OTA upgrade principle and process analysis 7.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 7.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="Android OTA - Android OTA upgrade principle and process analysis 8.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 8.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="Android OTA - Android OTA upgrade principle and process analysis 9.html">
            
                <a href="Android OTA - Android OTA upgrade principle and process analysis 9.html">
            
                    
                    Android OTA - Android OTA upgrade principle and process analysis 9
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Android Package Manager Service (PMS)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Android PMS - Explore the Android PMS service.html">
            
                <a href="Android PMS - Explore the Android PMS service.html">
            
                    
                    Android PMS - Explore the Android PMS service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="Android PMS - Some rules of the PMS runtime.html">
            
                <a href="Android PMS - Some rules of the PMS runtime.html">
            
                    
                    Android PMS - Some rules of the PMS runtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="Android PMS - Android 6 PMS Analysis.html">
            
                <a href="Android PMS - Android 6 PMS Analysis.html">
            
                    
                    Android PMS - Android 6 PMS Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="Android PMS - Android 6 PMS analysis article 1.html">
            
                <a href="Android PMS - Android 6 PMS analysis article 1.html">
            
                    
                    Android PMS - Android 6 PMS analysis article 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="Android PMS - Android 6 PMS analysis article 2.html">
            
                <a href="Android PMS - Android 6 PMS analysis article 2.html">
            
                    
                    Android PMS - Android 6 PMS analysis article 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="Android PMS - Android 6 PMS analysis of the next article.html">
            
                <a href="Android PMS - Android 6 PMS analysis of the next article.html">
            
                    
                    Android PMS - Android 6 PMS analysis of the next article
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="Android PMS - Android 6 PMS install APK prelude.html">
            
                <a href="Android PMS - Android 6 PMS install APK prelude.html">
            
                    
                    Android PMS - Android 6 PMS install APK prelude
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="Android PMS - Android 6 PMS installation APK.html">
            
                <a href="Android PMS - Android 6 PMS installation APK.html">
            
                    
                    Android PMS - Android 6 PMS installation APK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="Android PMS - Android 6 PMS installation APK next article.html">
            
                <a href="Android PMS - Android 6 PMS installation APK next article.html">
            
                    
                    Android PMS - Android 6 PMS installation APK next article
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="Android PMS - Android 6 PMS Uninstall APK.html">
            
                <a href="Android PMS - Android 6 PMS Uninstall APK.html">
            
                    
                    Android PMS - Android 6 PMS Uninstall APK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="Android PMS - Android 6 PMS daemon installd.html">
            
                <a href="Android PMS - Android 6 PMS daemon installd.html">
            
                    
                    Android PMS - Android 6 PMS daemon installd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Android AOSP
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="Android AOSP - Debugging AOSP Platform code with Android Studio - Java Debugger.html">
            
                <a href="Android AOSP - Debugging AOSP Platform code with Android Studio - Java Debugger.html">
            
                    
                    Android AOSP - Debugging AOSP Platform code with Android Studio - Java Debugger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="Android AOSP - Modify applications and rebuild emulator image effectively.html">
            
                <a href="Android AOSP - Modify applications and rebuild emulator image effectively.html">
            
                    
                    Android AOSP - Modify applications and rebuild emulator image effectively
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Android General
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="Android General - Reliable connection to AIDL IPC Service in Android.html">
            
                <a href="Android General - Reliable connection to AIDL IPC Service in Android.html">
            
                    
                    Android General - Reliable connection to AIDL IPC Service in Android
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Android Binder
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Android Activity Manager Service (AMS)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    Live555
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="Live555 - Live555 source code analysis_introduction.html">
            
                <a href="Live555 - Live555 source code analysis_introduction.html">
            
                    
                    Live555 - Live555 source code analysis_introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="Live555 - Live555 source code analysis_infrastructure.html">
            
                <a href="Live555 - Live555 source code analysis_infrastructure.html">
            
                    
                    Live555 - Live555 source code analysis_infrastructure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="Live555 - Live555 source code analysis_mediaserver.html">
            
                <a href="Live555 - Live555 source code analysis_mediaserver.html">
            
                    
                    Live555 - Live555 source code analysis_mediaserver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="Live555 - Wireshark capture packet analysis RTSP_RTP_RTCP basic working process.html">
            
                <a href="Live555 - Wireshark capture packet analysis RTSP_RTP_RTCP basic working process.html">
            
                    
                    Live555 - Wireshark capture packet analysis RTSP_RTP_RTCP basic working process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="Live555 - Live555 source code analysis_rtspserver.html">
            
                <a href="Live555 - Live555 source code analysis_rtspserver.html">
            
                    
                    Live555 - Live555 source code analysis_rtspserver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="Live555 - Live555 source code analysis_describe processing.html">
            
                <a href="Live555 - Live555 source code analysis_describe processing.html">
            
                    
                    Live555 - Live555 source code analysis_describe processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="Live555 - Live555 source code analysis_setup processing.html">
            
                <a href="Live555 - Live555 source code analysis_setup processing.html">
            
                    
                    Live555 - Live555 source code analysis_setup processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="Live555 - Live555 source code analysis_play processing.html">
            
                <a href="Live555 - Live555 source code analysis_play processing.html">
            
                    
                    Live555 - Live555 source code analysis_play processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="Live555 - Live555 source code analysis_RTSPServer component structure.html">
            
                <a href="Live555 - Live555 source code analysis_RTSPServer component structure.html">
            
                    
                    Live555 - Live555 source code analysis_RTSPServer component structure
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10.10" data-path="Live555 - Live555 source code analysis_servermediasession.html">
            
                <a href="Live555 - Live555 source code analysis_servermediasession.html">
            
                    
                    Live555 - Live555 source code analysis_servermediasession
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="Live555 - Live555 source code analysis_subsession SDP line generation.html">
            
                <a href="Live555 - Live555 source code analysis_subsession SDP line generation.html">
            
                    
                    Live555 - Live555 source code analysis_subsession SDP line generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="Live555 - Live555 source code analysis_Subsession SETUP.html">
            
                <a href="Live555 - Live555 source code analysis_Subsession SETUP.html">
            
                    
                    Live555 - Live555 source code analysis_Subsession SETUP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="Live555 - Live555 source code analysis_play start.html">
            
                <a href="Live555 - Live555 source code analysis_play start.html">
            
                    
                    Live555 - Live555 source code analysis_play start
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    Flutter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="Flutter Framework Analysis 1 - Overview and Window.html">
            
                <a href="Flutter Framework Analysis 1 - Overview and Window.html">
            
                    
                    Flutter Framework Analysis 1 - Overview and Window
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="Flutter Framework Analysis 2 - Initialization.html">
            
                <a href="Flutter Framework Analysis 2 - Initialization.html">
            
                    
                    Flutter Framework Analysis 2 - Initialization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="Flutter Framework Analysis 3 - Widget, Element and RenderObject.html">
            
                <a href="Flutter Framework Analysis 3 - Widget, Element and RenderObject.html">
            
                    
                    Flutter Framework Analysis 3 - Widget, Element and RenderObject
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="Flutter Framework Analysis 4 - Flutter Framework Operation.html">
            
                <a href="Flutter Framework Analysis 4 - Flutter Framework Operation.html">
            
                    
                    Flutter Framework Analysis 4 - Flutter Framework Operation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="Flutter Framework Analysis 5 - Animation.html">
            
                <a href="Flutter Framework Analysis 5 - Animation.html">
            
                    
                    Flutter Framework Analysis 5 - Animation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="Flutter Framework Analysis 6 - Layout.html">
            
                <a href="Flutter Framework Analysis 6 - Layout.html">
            
                    
                    Flutter Framework Analysis 6 - Layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="Flutter Framework Analysis 7 - Drawing.html">
            
                <a href="Flutter Framework Analysis 7 - Drawing.html">
            
                    
                    Flutter Framework Analysis 7 - Drawing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Live555 - Live555 source code analysis_servermediasession</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><span class="title-icon "></span><a href="#live555-source-code-analysis-servermediasession"><b>1. </b>Live555 Source code analysis: ServerMediaSession</a></li><ul><li><span class="title-icon "></span><a href="#servermediasession"><b>1.1. </b>ServerMediaSession</a></li><li><span class="title-icon "></span><a href="#servermediasubsession"><b>1.2. </b>ServerMediaSubsession</a></li><li><span class="title-icon "></span><a href="#live555-source-code-analysis-series"><b>1.3. </b>Live555 source code analysis series</a></li></ul></ul></div><a href="#live555-source-code-analysis-servermediasession" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="live555-source-code-analysis-servermediasession"><a name="live555-source-code-analysis-servermediasession" class="anchor-navigation-ex-anchor" href="#live555-source-code-analysis-servermediasession"><i class="fa fa-link" aria-hidden="true"></i></a>1. Live555 Source code analysis: ServerMediaSession</h1>
<p> Posted on 2017-09-07 |  In <a href="https://www.wolfcstech.com/categories/live555/" target="_blank">live555</a></p>
<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:0 orderedList:0 -->
<ul>
<li><a href="#live555-source-code-analysis-servermediasession"><strong>Live555 Source code analysis: ServerMediaSession</strong></a><ul>
<li><a href="#servermediasession"><strong>ServerMediaSession</strong></a></li>
<li><a href="#servermediasubsession"><strong>ServerMediaSubsession</strong></a></li>
<li><a href="#live555-source-code-analysis-series"><strong>Live555 source code analysis series</strong></a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<p>In live555, treated with a <code>ServerMediaSession</code> represents a streaming media
session, it connects <code>RTSPServer</code> and lower streaming
logic. <code>ServerMediaSession</code> and <code>ServerMediaSubsession</code> the common bottom for
performing streaming and state maintenance. And <code>ServerMediaSession</code> it
is <code>GenericMediaServer</code> by <code>HashTable</code> to maintain.</p>
<p>In the analysis processing live555 <code>DESCRIBE</code> requested code ( <a href="https://www.wolfcstech.com/2017/09/04/live555_src_analysis_describe/" target="_blank">live555 source code
analysis: <code>DESCRIBE</code> the
process</a> ),
we have seen <code>RTSPServer::RTSPClientConnection</code> to SDP message generated by
it. This article analyzes the definition and implementation of this class in
more detail.</p>
<h2 id="servermediasession"><a name="servermediasession" class="anchor-navigation-ex-anchor" href="#servermediasession"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. ServerMediaSession</h2>
<p>First, look at the <code>ServerMediaSession</code> definition:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">class ServerMediaSubsession; // forward
class ServerMediaSession: public Medium {
public:
  static ServerMediaSession* createNew(UsageEnvironment&amp; env,
      char const* streamName = NULL,
      char const* info = NULL,
      char const* description = NULL,
      Boolean isSSM = False,
      char const* miscSDPLines = NULL);
  static Boolean lookupByName(UsageEnvironment&amp; env,
      char const* mediumName,
      ServerMediaSession*&amp; resultSession);
  char* generateSDPDescription(); // based on the entire session
  // Note: The caller is responsible for freeing the returned string
  char const* streamName() const { return fStreamName; }
  Boolean addSubsession(ServerMediaSubsession* subsession);
  unsigned numSubsessions() const { return fSubsessionCounter; }
  void testScaleFactor(float&amp; scale); // sets &quot;scale&quot; to the actual supported scale
  float duration() const;
    // a result == 0 means an unbounded session (the default)
    // a result &lt; 0 means: subsession durations differ; the result is -(the largest).
    // a result &gt; 0 means: this is the duration of a bounded session
  virtual void noteLiveness();
    // called whenever a client - accessing this media - notes liveness.
    // The default implementation does nothing, but subclasses can redefine this - e.g., if you
    // want to remove long-unused &quot;ServerMediaSession&quot;s from the server.
  unsigned referenceCount() const { return fReferenceCount; }
  void incrementReferenceCount() { ++fReferenceCount; }
  void decrementReferenceCount() { if (fReferenceCount &gt; 0) --fReferenceCount; }
  Boolean&amp; deleteWhenUnreferenced() { return fDeleteWhenUnreferenced; }
  void deleteAllSubsessions();
    // Removes and deletes all subsessions added by &quot;addSubsession()&quot;, returning us to an &apos;empty&apos; state
    // Note: If you have already added this &quot;ServerMediaSession&quot; to a &quot;RTSPServer&quot; then, before calling this function,
    //   you must first close any client connections that use it,
    //   by calling &quot;RTSPServer::closeAllClientSessionsForServerMediaSession()&quot;.
protected:
  ServerMediaSession(UsageEnvironment&amp; env, char const* streamName,
      char const* info, char const* description,
      Boolean isSSM, char const* miscSDPLines);
  // called only by &quot;createNew()&quot;
  virtual ~ServerMediaSession();
private: // redefined virtual functions
  virtual Boolean isServerMediaSession() const;
private:
  Boolean fIsSSM;
  // Linkage fields:
  friend class ServerMediaSubsessionIterator;
  ServerMediaSubsession* fSubsessionsHead;
  ServerMediaSubsession* fSubsessionsTail;
  unsigned fSubsessionCounter;
  char* fStreamName;
  char* fInfoSDPString;
  char* fDescriptionSDPString;
  char* fMiscSDPLines;
  struct timeval fCreationTime;
  unsigned fReferenceCount;
  Boolean fDeleteWhenUnreferenced;
};<br></div></div>

<p>From this definition, difficult to understand, it is
mainly <code>ServerMediaSubsession</code> a container, and to maintain them through a one-way
linked list. And provides the entire operation requires the action of a
streaming media session all sub-session, such as the SDP message is
generated <code>generateSDPDescription()</code> and the playback speed is
set <code>testScaleFactor()</code>.</p>
<p><code>ServerMediaSession</code> Create objects, like live555 created many classes as through a
static creation functions <code>createNew()</code> to achieve, the function is defined as
follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">ServerMediaSession* ServerMediaSession
::createNew(UsageEnvironment&amp; env,
    char const* streamName, char const* info,
    char const* description, Boolean isSSM, char const* miscSDPLines) {
  return new ServerMediaSession(env, streamName, info, description,
      isSSM, miscSDPLines);
}
. . . . . .
static char const* const libNameStr = &quot;LIVE555 Streaming Media v&quot;;
char const* const libVersionStr = LIVEMEDIA_LIBRARY_VERSION_STRING;
ServerMediaSession::ServerMediaSession(UsageEnvironment&amp; env,
    char const* streamName,
    char const* info,
    char const* description,
    Boolean isSSM, char const* miscSDPLines)
  : Medium(env), fIsSSM(isSSM), fSubsessionsHead(NULL),
    fSubsessionsTail(NULL), fSubsessionCounter(0),
    fReferenceCount(0), fDeleteWhenUnreferenced(False) {
  fStreamName = strDup(streamName == NULL ? &quot;&quot; : streamName);
  char* libNamePlusVersionStr = NULL; // by default
  if (info == NULL || description == NULL) {
    libNamePlusVersionStr = new char[strlen(libNameStr) + strlen(libVersionStr) + 1];
    sprintf(libNamePlusVersionStr, &quot;%s%s&quot;, libNameStr, libVersionStr);
  }
  fInfoSDPString = strDup(info == NULL ? libNamePlusVersionStr : info);
  fDescriptionSDPString = strDup(description == NULL ? libNamePlusVersionStr : description);
  delete[] libNamePlusVersionStr;
  fMiscSDPLines = strDup(miscSDPLines == NULL ? &quot;&quot; : miscSDPLines);
  gettimeofday(&amp;fCreationTime, NULL);
}
ServerMediaSession::~ServerMediaSession() {
  deleteAllSubsessions();
  delete[] fStreamName;
  delete[] fInfoSDPString;
  delete[] fDescriptionSDPString;
  delete[] fMiscSDPLines;
}<br></div></div>

<p>Each <code>ServerMediaSession</code> consists of a string of the <code>streamName</code> identifier, the
identifier is in <code>GenericMediaServer</code> by <code>HashTable</code> time to maintain, with the
key. <code>streamName</code> Passed by the caller when it is created. For <em>&quot;LIVE555 Media Server&quot;</em>,
this value is the path to the resource.</p>
<p>The caller can also be passed when creating <code>info</code> and <code>description</code> providing more
descriptive information about the session. For <em>&quot;LIVE555 Media Server&quot;</em>, <code>info</code> the
same as the path of the resource, but <code>description</code> a string containing the
streaming media type format <code>&quot;$MediaType, streamed by the LIVE555 Media Server&quot;</code>,
such as for H.264 video
<code>&quot;H.264 Video, streamed by the LIVE555 Media Server&quot;</code>&#x3002;</p>
<p>When you create an object, you mainly initialize the state with the value passed
in by the caller.</p>
<p>Like many other <code>Medium</code> sub-classes, <code>ServerMediaSession</code> also it provides an object
lookup functions:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">Boolean ServerMediaSession
::lookupByName(UsageEnvironment&amp; env, char const* mediumName,
    ServerMediaSession*&amp; resultSession) {
  resultSession = NULL; // unless we succeed
  Medium* medium;
  if (!Medium::lookupByName(env, mediumName, medium)) return False;
  if (!medium-&gt;isServerMediaSession()) {
    env.setResultMsg(mediumName, &quot; is not a &apos;ServerMediaSession&apos; object&quot;);
    return False;
  }
  resultSession = (ServerMediaSession*)medium;
  return True;
}<br></div></div>

<p>As <code>ServerMediaSubsession</code> containers, <code>ServerMediaSession</code> also
provides <code>ServerMediaSubsession</code> the added management operations:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">Boolean
ServerMediaSession::addSubsession(ServerMediaSubsession* subsession) {
  if (subsession-&gt;fParentSession != NULL) return False; // it&apos;s already used
  if (fSubsessionsTail == NULL) {
    fSubsessionsHead = subsession;
  } else {
    fSubsessionsTail-&gt;fNext = subsession;
  }
  fSubsessionsTail = subsession;
  subsession-&gt;fParentSession = this;
  subsession-&gt;fTrackNumber = ++fSubsessionCounter;
  return True;
}
. . . . . .
void ServerMediaSession::noteLiveness() {
  // default implementation: do nothing
}
void ServerMediaSession::deleteAllSubsessions() {
  Medium::close(fSubsessionsHead);
  fSubsessionsHead = fSubsessionsTail = NULL;
  fSubsessionCounter = 0;
}
Boolean ServerMediaSession::isServerMediaSession() const {
  return True;
}
. . . . . .<br></div></div>

<p>Ask <code>ServerMediaSession</code> when you add sub-session, the newly added sub-session will
always be placed on a one-way linked list header. Time to add sub-session, the
session will be based on the sub counter <code>fSubsessionCounter</code> assigned track number
for the sub-session.</p>
<p>SDP messages for generating <code>generateSDPDescription()</code> and <code>duration()</code> function, and
to set the speed of playback <code>testScaleFactor(float&amp; scale)</code> functions, in <a href="https://www.wolfcstech.com/2017/09/04/live555_src_analysis_describe/" target="_blank">live555 source analysis: the DESCRIBE processing</a>
and <a href="https://www.wolfcstech.com/2017/09/05/live555_src_analysis_play/" target="_blank">live555 source code analysis: PLAY processing is</a> already described in a more detailed manner, is not repeated here.</p>
<p>For easy access <code>ServerMediaSubsession</code>, live555 also provides an iterator, which
is defined as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">class ServerMediaSubsessionIterator {
public:
  ServerMediaSubsessionIterator(ServerMediaSession&amp; session);
  virtual ~ServerMediaSubsessionIterator();
  ServerMediaSubsession* next(); // NULL if none
  void reset();
private:
  ServerMediaSession&amp; fOurSession;
  ServerMediaSubsession* fNextPtr;
};<br></div></div>

<p>The iterator is implemented as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">ServerMediaSubsessionIterator
::ServerMediaSubsessionIterator(ServerMediaSession&amp; session)
  : fOurSession(session) {
  reset();
}
ServerMediaSubsessionIterator::~ServerMediaSubsessionIterator() {
}
ServerMediaSubsession* ServerMediaSubsessionIterator::next() {
  ServerMediaSubsession* result = fNextPtr;
  if (fNextPtr != NULL) fNextPtr = fNextPtr-&gt;fNext;
  return result;
}
void ServerMediaSubsessionIterator::reset() {
  fNextPtr = fOurSession.fSubsessionsHead;
}<br></div></div>

<p>We can see <code>ServerMediaSession</code> and there is not much content. Most of the time, it
obtained only as <code>ServerMediaSubsession</code> an intermediary exists.</p>
<h2 id="servermediasubsession"><a name="servermediasubsession" class="anchor-navigation-ex-anchor" href="#servermediasubsession"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. ServerMediaSubsession</h2>
<p>In the <code>RTSPServer::RTSPClientSession</code> processing <code>SETUP</code> code requests, we see it
from <code>ServerMediaSession</code> obtaining <code>ServerMediaSubsession</code> and took over their
management, and bypass <code>ServerMediaSession</code> direct
to <code>ServerMediaSubsession</code> operate. The entry to perform data operations for a
single session of streaming media is also there <code>ServerMediaSubsession</code>.</p>
<p>For the case of requesting an H.264 video file from the <em>&quot;LIVE555 Media Server&quot;</em>
server, <code>ServerMediaSubsession</code> the actual type
is <code>H264VideoFileServerMediaSubsession</code>, we use this as an example to
analyze <code>ServerMediaSubsession</code>.</p>
<p><code>H264VideoFileServerMediaSubsession</code> In
the <code>DynamicRTSPServer</code> class <code>lookupServerMediaSession()</code> in with
the <code>ServerMediaSession</code> creation together to create and be added directly to
the <code>ServerMediaSession</code> medium.</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">#define NEW_SMS(description) do {\
char const* descStr = description\
    &quot;, streamed by the LIVE555 Media Server&quot;;\
sms = ServerMediaSession::createNew(env, fileName, fileName, descStr);\
} while(0)
. . . . . .
  } else if (strcmp(extension, &quot;.264&quot;) == 0) {
    // Assumed to be a H.264 Video Elementary Stream file:
    NEW_SMS(&quot;H.264 Video&quot;);
    OutPacketBuffer::maxSize = 100000; // allow for some possibly large H.264 frames
    sms-&gt;addSubsession(H264VideoFileServerMediaSubsession::createNew(env, fileName, reuseSource));
  }<br></div></div>

<p><code>H264VideoFileServerMediaSubsession</code> has an inheritance system as shown below:</p>
<p>     <a href="media/049b64864c6a71113fcafb090ef218d0.png" rel="grouped" title="https://www.wolfcstech.com/images/1315506-1e2dfc17512a3909.png" target="_self" class="fancybox">
       <img src="media/049b64864c6a71113fcafb090ef218d0.png" alt="https://www.wolfcstech.com/images/1315506-1e2dfc17512a3909.png">
     </a></p>
<p>In this inheritance system, <code>ServerMediaSubsession</code> operations that can be
performed on a single stream are defined. The definition of the class is as
follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">class ServerMediaSubsession: public Medium {
public:
  unsigned trackNumber() const { return fTrackNumber; }
  char const* trackId();
  virtual char const* sdpLines() = 0;
  virtual void getStreamParameters(unsigned clientSessionId, // in
      netAddressBits clientAddress, // in
      Port const&amp; clientRTPPort, // in
      Port const&amp; clientRTCPPort, // in
      int tcpSocketNum, // in (-1 means use UDP, not TCP)
      unsigned char rtpChannelId, // in (used if TCP)
      unsigned char rtcpChannelId, // in (used if TCP)
      netAddressBits&amp; destinationAddress, // in out
      u_int8_t&amp; destinationTTL, // in out
      Boolean&amp; isMulticast, // out
      Port&amp; serverRTPPort, // out
      Port&amp; serverRTCPPort, // out
      void*&amp; streamToken // out
      ) = 0;
  virtual void startStream(unsigned clientSessionId, void* streamToken,
      TaskFunc* rtcpRRHandler,
      void* rtcpRRHandlerClientData,
      unsigned short&amp; rtpSeqNum,
      unsigned&amp; rtpTimestamp,
      ServerRequestAlternativeByteHandler* serverRequestAlternativeByteHandler,
      void* serverRequestAlternativeByteHandlerClientData) = 0;
  virtual void pauseStream(unsigned clientSessionId, void* streamToken);
  virtual void seekStream(unsigned clientSessionId, void* streamToken, double&amp; seekNPT,
      double streamDuration, u_int64_t&amp; numBytes);
     // This routine is used to seek by relative (i.e., NPT) time.
     // &quot;streamDuration&quot;, if &gt;0.0, specifies how much data to stream, past &quot;seekNPT&quot;.  (If &lt;=0.0, all remaining data is streamed.)
     // &quot;numBytes&quot; returns the size (in bytes) of the data to be streamed, or 0 if unknown or unlimited.
  virtual void seekStream(unsigned clientSessionId, void* streamToken, char*&amp; absStart, char*&amp; absEnd);
     // This routine is used to seek by &apos;absolute&apos; time.
     // &quot;absStart&quot; should be a string of the form &quot;YYYYMMDDTHHMMSSZ&quot; or &quot;YYYYMMDDTHHMMSS.&lt;frac&gt;Z&quot;.
     // &quot;absEnd&quot; should be either NULL (for no end time), or a string of the same form as &quot;absStart&quot;.
     // These strings may be modified in-place, or can be reassigned to a newly-allocated value (after delete[]ing the original).
  virtual void nullSeekStream(unsigned clientSessionId, void* streamToken,
      double streamEndTime, u_int64_t&amp; numBytes);
     // Called whenever we&apos;re handling a &quot;PLAY&quot; command without a specified start time.
  virtual void setStreamScale(unsigned clientSessionId, void* streamToken, float scale);
  virtual float getCurrentNPT(void* streamToken);
  virtual FramedSource* getStreamSource(void* streamToken);
  virtual void getRTPSinkandRTCP(void* streamToken,
      RTPSink const*&amp; rtpSink, RTCPInstance const*&amp; rtcp) = 0;
     // Returns pointers to the &quot;RTPSink&quot; and &quot;RTCPInstance&quot; objects for &quot;streamToken&quot;.
     // (This can be useful if you want to get the associated &apos;Groupsock&apos; objects, for example.)
     // You must not delete these objects, or start/stop playing them; instead, that is done
     // using the &quot;startStream()&quot; and &quot;deleteStream()&quot; functions.
  virtual void deleteStream(unsigned clientSessionId, void*&amp; streamToken);
  virtual void testScaleFactor(float&amp; scale); // sets &quot;scale&quot; to the actual supported scale
  virtual float duration() const;
    // returns 0 for an unbounded session (the default)
    // returns &gt; 0 for a bounded session
  virtual void getAbsoluteTimeRange(char*&amp; absStartTime, char*&amp; absEndTime) const;
    // Subclasses can reimplement this iff they support seeking by &apos;absolute&apos; time.
  // The following may be called by (e.g.) SIP servers, for which the
  // address and port number fields in SDP descriptions need to be non-zero:
  void setServerAddressAndPortForSDP(netAddressBits addressBits,
      portNumBits portBits);
protected: // we&apos;re a virtual base class
  ServerMediaSubsession(UsageEnvironment&amp; env);
  virtual ~ServerMediaSubsession();
  char const* rangeSDPLine() const;
      // returns a string to be delete[]d
  ServerMediaSession* fParentSession;
  netAddressBits fServerAddressForSDP;
  portNumBits fPortNumForSDP;
private:
  friend class ServerMediaSession;
  friend class ServerMediaSubsessionIterator;
  ServerMediaSubsession* fNext;
  unsigned fTrackNumber; // within an enclosing ServerMediaSession
  char const* fTrackId;
};<br></div></div>

<p>These operations may be divided into several categories, one is a playback
control operation, including 
<code>startStream()</code>, <code>pauseStream()</code>, <code>seekStream()</code>, <code>nullSeekStream()</code>, <code>setStreamScale()</code>, <code>deleteStream()</code> and <code>testScaleFactor()</code>;
the other is obtained for performing I/O
operations <code>FramedSource</code> and <code>RTPSink</code> the <code>getStreamSource()</code> and <code>getRTPSinkandRTCP()</code>.</p>
<p><code>ServerMediaSubsession</code> The class provides implementations of common operations for
several subsessions, including mainly for generating track ids in the form of
strings <code>trackId()</code>, for setting the SDP server address and port
number <code>setServerAddressAndPortForSDP()</code>, and for generating SDP lines for
subsessions <code>rangeSDPLine()</code>:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">ServerMediaSubsession::ServerMediaSubsession(UsageEnvironment&amp; env)
  : Medium(env),
    fParentSession(NULL), fServerAddressForSDP(0), fPortNumForSDP(0),
    fNext(NULL), fTrackNumber(0), fTrackId(NULL) {
}
ServerMediaSubsession::~ServerMediaSubsession() {
  delete[] (char*)fTrackId;
  Medium::close(fNext);
}
char const* ServerMediaSubsession::trackId() {
  if (fTrackNumber == 0) return NULL; // not yet in a ServerMediaSession
  if (fTrackId == NULL) {
    char buf[100];
    sprintf(buf, &quot;track%d&quot;, fTrackNumber);
    fTrackId = strDup(buf);
  }
  return fTrackId;
}
. . . . . .
void ServerMediaSubsession::setServerAddressAndPortForSDP(netAddressBits addressBits,
    portNumBits portBits) {
  fServerAddressForSDP = addressBits;
  fPortNumForSDP = portBits;
}
char const*
ServerMediaSubsession::rangeSDPLine() const {
  // First, check for the special case where we support seeking by &apos;absolute&apos; time:
  char* absStart = NULL; char* absEnd = NULL;
  getAbsoluteTimeRange(absStart, absEnd);
  if (absStart != NULL) {
    char buf[100];
    if (absEnd != NULL) {
      sprintf(buf, &quot;a=range:clock=%s-%s\r\n&quot;, absStart, absEnd);
    } else {
      sprintf(buf, &quot;a=range:clock=%s-\r\n&quot;, absStart);
    }
    return strDup(buf);
  }
  if (fParentSession == NULL) return NULL;
  // If all of our parent&apos;s subsessions have the same duration
  // (as indicated by &quot;fParentSession-&gt;duration() &gt;= 0&quot;), there&apos;s no &quot;a=range:&quot; line:
  if (fParentSession-&gt;duration() &gt;= 0.0) return strDup(&quot;&quot;);
  // Use our own duration for a &quot;a=range:&quot; line:
  float ourDuration = duration();
  if (ourDuration == 0.0) {
    return strDup(&quot;a=range:npt=0-\r\n&quot;);
  } else {
    char buf[100];
    sprintf(buf, &quot;a=range:npt=0-%.3f\r\n&quot;, ourDuration);
    return strDup(buf);
  }
}<br></div></div>

<p>These operations are relatively concise and will not be described here.</p>
<p>For many other interfaces that operate on a single stream,
the <code>ServerMediaSubsession</code> class simply provides an empty default implementation:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">void ServerMediaSubsession::pauseStream(unsigned /*clientSessionId*/,
    void* /*streamToken*/) {
  // default implementation: do nothing
}
void ServerMediaSubsession::seekStream(unsigned /*clientSessionId*/,
    void* /*streamToken*/, double&amp; /*seekNPT*/, double /*streamDuration*/, u_int64_t&amp; numBytes) {
  // default implementation: do nothing
  numBytes = 0;
}
void ServerMediaSubsession::seekStream(unsigned /*clientSessionId*/,
    void* /*streamToken*/, char*&amp; absStart, char*&amp; absEnd) {
  // default implementation: do nothing (but delete[] and assign &quot;absStart&quot; and &quot;absEnd&quot; to NULL, to show that we don&apos;t handle this)
  delete[] absStart; absStart = NULL;
  delete[] absEnd; absEnd = NULL;
}
void ServerMediaSubsession::nullSeekStream(unsigned /*clientSessionId*/,
    void* /*streamToken*/, double streamEndTime, u_int64_t&amp; numBytes) {
  // default implementation: do nothing
  numBytes = 0;
}
void ServerMediaSubsession::setStreamScale(unsigned /*clientSessionId*/,
    void* /*streamToken*/, float /*scale*/) {
  // default implementation: do nothing
}
float ServerMediaSubsession::getCurrentNPT(void* /*streamToken*/) {
  // default implementation: return 0.0
  return 0.0;
}
FramedSource* ServerMediaSubsession::getStreamSource(void* /*streamToken*/) {
  // default implementation: return NULL
  return NULL;
}
void ServerMediaSubsession::deleteStream(unsigned /*clientSessionId*/,
    void*&amp; /*streamToken*/) {
  // default implementation: do nothing
}
void ServerMediaSubsession::testScaleFactor(float&amp; scale) {
  // default implementation: Support scale = 1 only
  scale = 1;
}
float ServerMediaSubsession::duration() const {
  // default implementation: assume an unbounded session:
  return 0.0;
}
void ServerMediaSubsession::getAbsoluteTimeRange(char*&amp; absStartTime, char*&amp; absEndTime) const {
  // default implementation: We don&apos;t support seeking by &apos;absolute&apos; time, so indicate this by setting both parameters to NULL:
  absStartTime = absEndTime = NULL;
}<br></div></div>

<p><code>OnDemandServerMediaSubsession</code> realized by a <code>ServerMediaSubsession</code> defined stream
operator interface. In order to achieve these operations, some I/O operations
are required, such as parsing streaming media files, transceiving RTP/RTCP
packets, and so on. These I/O operation due to the different specific types of
streaming media sources differ, and therefore not directly in
the <code>OnDemandServerMediaSubsession</code> implementation. <code>OnDemandServerMediaSubsession</code> It
defines a new virtual function, so as to obtain from the
subclass <code>FramedSource</code> and <code>RTPSink</code> objects, to perform I/O operations.</p>
<p><code>OnDemandServerMediaSubsession</code> The specific implementation will not be explained
in detail for the time being.</p>
<p>In <code>H264VideoFileServerMediaSubsession</code> the class inheritance hierarchy,
the <code>FileServerMediaSubsession</code> file name for the maintenance resources, which is
defined as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">class FileServerMediaSubsession: public OnDemandServerMediaSubsession {
protected: // we&apos;re a virtual base class
  FileServerMediaSubsession(UsageEnvironment&amp; env, char const* fileName,
                Boolean reuseFirstSource);
  virtual ~FileServerMediaSubsession();
protected:
  char const* fFileName;
  u_int64_t fFileSize; // if known
};<br></div></div>

<p>This definition is very simple and its implementation is simple:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">FileServerMediaSubsession
::FileServerMediaSubsession(UsageEnvironment&amp; env, char const* fileName,
                Boolean reuseFirstSource)
  : OnDemandServerMediaSubsession(env, reuseFirstSource),
    fFileSize(0) {
  fFileName = strDup(fileName);
}
FileServerMediaSubsession::~FileServerMediaSubsession() {
  delete[] (char*)fFileName;
}<br></div></div>

<p><code>H264VideoFileServerMediaSubsession</code> the main function is to provide means for
performing I/O operations <code>FramedSource</code> and <code>RTPSink</code> defined as follows:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">class H264VideoFileServerMediaSubsession: public FileServerMediaSubsession {
public:
  static H264VideoFileServerMediaSubsession*
  createNew(UsageEnvironment&amp; env, char const* fileName, Boolean reuseFirstSource);
  // Used to implement &quot;getAuxSDPLine()&quot;:
  void checkForAuxSDPLine1();
  void afterPlayingDummy1();
protected:
  H264VideoFileServerMediaSubsession(UsageEnvironment&amp; env,
      char const* fileName, Boolean reuseFirstSource);
  // called only by createNew();
  virtual ~H264VideoFileServerMediaSubsession();
  void setDoneFlag() { fDoneFlag = ~0; }
protected: // redefined virtual functions
  virtual char const* getAuxSDPLine(RTPSink* rtpSink,
      FramedSource* inputSource);
  virtual FramedSource* createNewStreamSource(unsigned clientSessionId,
      unsigned&amp; estBitrate);
  virtual RTPSink* createNewRTPSink(Groupsock* rtpGroupsock,
      unsigned char rtpPayloadTypeIfDynamic,
      FramedSource* inputSource);
private:
  char* fAuxSDPLine;
  char fDoneFlag; // used when setting up &quot;fAuxSDPLine&quot;
  RTPSink* fDummyRTPSink; // ditto
};<br></div></div>

<p><code>H264VideoFileServerMediaSubsession</code> By implementing <code>createNewStreamSource()</code> and <code>createNewRTPSink()</code> creates and
returns <code>FramedSource</code> and <code>RTPSink</code>:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">FramedSource* H264VideoFileServerMediaSubsession::createNewStreamSource(unsigned /*clientSessionId*/, unsigned&amp; estBitrate) {
  estBitrate = 500; // kbps, estimate
  // Create the video source:
  ByteStreamFileSource* fileSource = ByteStreamFileSource::createNew(envir(), fFileName);
  if (fileSource == NULL) return NULL;
  fFileSize = fileSource-&gt;fileSize();
  // Create a framer for the Video Elementary Stream:
  return H264VideoStreamFramer::createNew(envir(), fileSource);
}
RTPSink* H264VideoFileServerMediaSubsession
::createNewRTPSink(Groupsock* rtpGroupsock,
    unsigned char rtpPayloadTypeIfDynamic,
    FramedSource* /*inputSource*/) {
  return H264VideoRTPSink::createNew(envir(), rtpGroupsock, rtpPayloadTypeIfDynamic);
}<br></div></div>

<p>Here returned <code>FramedSource</code> to <strong>H264VideoStreamFramer</strong> returned <code>RTPSink</code> to <strong>H264VideoRTPSink</strong>.</p>
<p>In addition to this, <code>H264VideoFileServerMediaSubsession</code> the interface
implementation of the AUX SDP line is also provided:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;c_cpp&quot;,&quot;check&quot;:false,&quot;theme&quot;:&quot;monokai&quot;}">H264VideoFileServerMediaSubsession::H264VideoFileServerMediaSubsession(UsageEnvironment&amp; env,
    char const* fileName, Boolean reuseFirstSource) :
    FileServerMediaSubsession(env, fileName, reuseFirstSource),
    fAuxSDPLine(NULL), fDoneFlag(0), fDummyRTPSink(NULL) {
}
H264VideoFileServerMediaSubsession::~H264VideoFileServerMediaSubsession() {
  delete[] fAuxSDPLine;
}
static void afterPlayingDummy(void* clientData) {
  H264VideoFileServerMediaSubsession* subsess = (H264VideoFileServerMediaSubsession*)clientData;
  subsess-&gt;afterPlayingDummy1();
}
void H264VideoFileServerMediaSubsession::afterPlayingDummy1() {
  // Unschedule any pending &apos;checking&apos; task:
  envir().taskScheduler().unscheduleDelayedTask(nextTask());
  // Signal the event loop that we&apos;re done:
  setDoneFlag();
}
static void checkForAuxSDPLine(void* clientData) {
  H264VideoFileServerMediaSubsession* subsess = (H264VideoFileServerMediaSubsession*)clientData;
  subsess-&gt;checkForAuxSDPLine1();
}
void H264VideoFileServerMediaSubsession::checkForAuxSDPLine1() {
  nextTask() = NULL;
  char const* dasl;
  if (fAuxSDPLine != NULL) {
    // Signal the event loop that we&apos;re done:
    setDoneFlag();
  } else if (fDummyRTPSink != NULL &amp;&amp; (dasl = fDummyRTPSink-&gt;auxSDPLine()) != NULL) {
    fAuxSDPLine = strDup(dasl);
    fDummyRTPSink = NULL;
    // Signal the event loop that we&apos;re done:
    setDoneFlag();
  } else if (!fDoneFlag) {
    // try again after a brief delay:
    int uSecsToDelay = 100000; // 100 ms
    nextTask() = envir().taskScheduler().scheduleDelayedTask(uSecsToDelay,
        (TaskFunc*) checkForAuxSDPLine, this);
  }
}
char const* H264VideoFileServerMediaSubsession::getAuxSDPLine(RTPSink* rtpSink, FramedSource* inputSource) {
  if (fAuxSDPLine != NULL) return fAuxSDPLine; // it&apos;s already been set up (for a previous client)
  if (fDummyRTPSink == NULL) { // we&apos;re not already setting it up for another, concurrent stream
    // Note: For H264 video files, the &apos;config&apos; information (&quot;profile-level-id&quot; and &quot;sprop-parameter-sets&quot;) isn&apos;t known
    // until we start reading the file.  This means that &quot;rtpSink&quot;s &quot;auxSDPLine()&quot; will be NULL initially,
    // and we need to start reading data from our file until this changes.
    fDummyRTPSink = rtpSink;
    // Start reading the file:
    fDummyRTPSink-&gt;startPlaying(*inputSource, afterPlayingDummy, this);
    // Check whether the sink&apos;s &apos;auxSDPLine()&apos; is ready:
    checkForAuxSDPLine(this);
  }
  envir().taskScheduler().doEventLoop(&amp;fDoneFlag);
  return fAuxSDPLine;
}<br></div></div>

<p><a href="https://www.wolfcstech.com/about/donate.html" target="_blank">Reward</a></p>
<p>Done.</p>
<h2 id="live555-source-code-analysis-series"><a name="live555-source-code-analysis-series" class="anchor-navigation-ex-anchor" href="#live555-source-code-analysis-series"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Live555 source code analysis series</h2>
<ol>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_introduction.html">Live555 Source code analysis: Introduction </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_infrastructure.html">live555 Source code analysis: Infrastructure </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_mediaserver.html">live555 Source code analysis: MediaSever </a></li>
<li><a href="Live555%20-%20Wireshark%20capture%20packet%20analysis%20RTSP_RTP_RTCP%20basic%20working%20process.html">Wireshark capture packet analysis RTSP/RTP/RTCP Basic working process </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_rtspserver.html">live555 Source code analysis: RTSPServer </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_describe%20processing.html">live555 Source code analysis: DESCRIBE processing </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_setup%20processing.html">live555 Source code analysis: SETUP processing </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_play%20processing.html">live555 Source code analysis :PLAY processing </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_RTSPServer%20component%20structure.html">live555 Source code analysis: RTSPServer component structure </a></li>
<li><a href="https://www.wolfcstech.com/2017/09/07/live555_src_analysis_servermediasession/" target="_blank">live555 Source code analysis: </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_subsession%20SDP%20line%20generation.html">ServerMediaSession live555 Source code analysis: sub-session SDP line generation </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_Subsession%20SETUP.html">live555 Source code analysis: sub-session SETUP </a></li>
<li><a href="Live555%20-%20Live555%20source%20code%20analysis_play%20start.html">live555 Source code analysis: play start</a></li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Live555 - Live555 source code analysis_RTSPServer component structure.html" class="navigation navigation-prev " aria-label="Previous page: Live555 - Live555 source code analysis_RTSPServer component structure">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Live555 - Live555 source code analysis_subsession SDP line generation.html" class="navigation navigation-next " aria-label="Next page: Live555 - Live555 source code analysis_subsession SDP line generation">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Live555 - Live555 source code analysis_servermediasession","level":"1.10.10","depth":2,"next":{"title":"Live555 - Live555 source code analysis_subsession SDP line generation","level":"1.10.11","depth":2,"path":"Live555 - Live555 source code analysis_subsession SDP line generation.md","ref":"Live555 - Live555 source code analysis_subsession SDP line generation.md","articles":[]},"previous":{"title":"Live555 - Live555 source code analysis_RTSPServer component structure","level":"1.10.9","depth":2,"path":"Live555 - Live555 source code analysis_RTSPServer component structure.md","ref":"Live555 - Live555 source code analysis_RTSPServer component structure.md","articles":[]},"dir":"ltr"},"config":{"plugins":["include-html","fancybox","anchor-navigation-ex-toc","ace","-lunr","-search","search-plus","hide-published-with","splitter","expandable-chapters-interactive","wide-page"],"root":"./docs","styles":{"website":"styles/website.css"},"pluginsConfig":{"fancybox":{"helpers":{"buttons":{}}},"ace":{},"splitter":{},"wide-page":{},"anchor-navigation-ex-toc":{"showLevel":true,"associatedWithSummary":true,"mode":"float","printLog":false,"multipleH1":true,"float":{"showLevelIcon":false,"level1Icon":"","level2Icon":"","level3Icon":""},"pageTop":{"showLevelIcon":false,"level1Icon":"","level2Icon":"","level3Icon":""}},"hide-published-with":{},"include-html":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"expandable-chapters-interactive":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{},"search-plus":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"Live555 - Live555 source code analysis_servermediasession.md","mtime":"2019-03-05T06:20:55.097Z","type":"markdown"},"gitbook":{"version":"3.3.6","time":"2023-12-10T09:35:29.798Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-hide-published-with/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-expandable-chapters-interactive/expandable-chapters.js"></script>
        
    
        
        <script src="gitbook/@gitbook-ng/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

